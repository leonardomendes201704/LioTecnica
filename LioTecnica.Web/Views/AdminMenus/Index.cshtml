@model LioTecnica.Web.ViewModels.Admin.MenusPageViewModel
@using System.Text.Json
@{
    ViewData["Title"] = "Portal RH - Menus";
    ViewData["SidebarSubtitle"] = "Menus";
    var jsonOptions = new JsonSerializerOptions { PropertyNamingPolicy = JsonNamingPolicy.CamelCase };
}

@section Topbar {
    @await Html.PartialAsync("_TopbarBrand", "Tela: Menus")

    <div class="searchbox position-relative d-none d-md-block">
        <i class="bi bi-search"></i>
        <input id="globalSearchMenus" class="form-control" placeholder="Buscar menu..." />
    </div>

    <div class="d-flex align-items-center gap-2">
        <a class="btn btn-brand" href="/Admin/Menus/New">
            <i class="bi bi-plus-lg"></i><span class="d-none d-sm-inline ms-1">Novo menu</span>
        </a>
        @await Html.PartialAsync("_TopbarUserMenu", "Admin")
    </div>
}

<section class="content">
    <div class="page-title">
        <div>
            <h4>Menus</h4>
            <div class="subtitle">Itens de menu e permissoes.</div>
        </div>
        <div class="d-flex align-items-center gap-2">
            <span class="badge-soft"><i class="bi bi-clock me-1"></i><span id="nowLabel">-</span></span>
            <span class="badge-soft"><i class="bi bi-hdd me-1"></i>API</span>
        </div>
    </div>

    @{
        var kpis = new[]
        {
            new { ColClass = "col-6 col-lg-3", Title = "Menus", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiMenusTotal", Value = "0", PillIcon = "bi-list", PillText = "total", Hint = "Itens cadastrados." },
            new { ColClass = "col-6 col-lg-3", Title = "Ativos", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiMenusActive", Value = "0", PillIcon = "bi-check2-circle", PillText = "ok", Hint = "Menus ativos." },
            new { ColClass = "col-6 col-lg-3", Title = "Inativos", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiMenusInactive", Value = "0", PillIcon = "bi-slash-circle", PillText = "off", Hint = "Menus inativos." },
            new { ColClass = "col-6 col-lg-3", Title = "Com icone", ValueStyle = "font-size:1.6rem;color:var(--lt-primary);", ValueId = "kpiMenusIcon", Value = "0", PillIcon = "bi-star", PillText = "icone", Hint = "Menus com icone." }
        };
    }
    @await Html.PartialAsync("_KpiMiniRow", kpis)

    <div class="card-soft p-3 mb-3">
        <div class="d-flex flex-wrap align-items-end justify-content-between gap-2">
            <div>
                <div class="fw-bold">Lista de menus</div>
                <div class="text-muted small">Clique em um item para editar.</div>
            </div>
            <div class="d-flex flex-wrap gap-2 justify-content-end">
                <div style="min-width:240px;">
                    <label class="form-label small mb-1">Buscar</label>
                    <div class="input-group">
                        <span class="input-group-text" style="background:rgba(255,255,255,.65)"><i class="bi bi-search"></i></span>
                        <input class="form-control" id="mSearch" placeholder="titulo, rota, perm...">
                    </div>
                </div>
                <div>
                    <label class="form-label small mb-1">Status</label>
                    <select class="form-select" id="mStatus">
                        <option value="all">Todos</option>
                        <option value="active">Ativo</option>
                        <option value="inactive">Inativo</option>
                    </select>
                </div>
            </div>
        </div>

        <hr class="my-3 divider">

        <table class="table table-sm align-middle mb-0">
            <thead>
                <tr>
                    <th>Menu</th>
                    <th>Rota</th>
                    <th>Permissao</th>
                    <th>Ordem</th>
                    <th>Status</th>
                    <th class="text-end">Acoes</th>
                </tr>
            </thead>
            <tbody id="menusTbody"></tbody>
        </table>

        <div class="d-flex align-items-center justify-content-between mt-2">
            <div class="text-muted small" id="menusHint">-</div>
            <div class="d-flex align-items-center gap-2">
                <span class="pill"><i class="bi bi-table"></i><span id="menusCount">0</span> exibidos</span>
            </div>
        </div>
    </div>

    <template id="tpl-menu-row">
        <tr>
            <td>
                <div class="fw-semibold" data-role="menu-name"></div>
                <div class="text-muted small mono" data-role="menu-id"></div>
            </td>
            <td class="mono" data-role="menu-route"></td>
            <td class="mono" data-role="menu-permission"></td>
            <td class="mono" data-role="menu-order"></td>
            <td><span data-role="menu-status"></span></td>
            <td class="text-end">
                <button class="btn btn-ghost btn-sm me-1" type="button" data-act="detail"><i class="bi bi-eye"></i></button>
                <button class="btn btn-ghost btn-sm me-1" type="button" data-act="edit"><i class="bi bi-pencil"></i></button>
                <button class="btn btn-ghost btn-sm text-danger" type="button" data-act="del"><i class="bi bi-trash3"></i></button>
            </td>
        </tr>
    </template>

    <template id="tpl-menu-empty">
        <tr>
            <td colspan="6" class="text-center text-muted py-3">Nenhum menu encontrado.</td>
        </tr>
    </template>

    <div style="height:14px;"></div>
</section>

<div class="modal fade" id="modalAdminMenu" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content" style="border-radius: 18px; border: 1px solid var(--lt-border);">
            <div class="modal-header">
                <div>
                    <h5 class="modal-title fw-bold" id="modalAdminMenuTitle">Editar menu</h5>
                    <div class="text-muted small">Atualize dados do menu.</div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="adminMenuId">

                <div class="row g-2">
                    <div class="col-12 col-md-6">
                        <label class="form-label small text-muted">Nome *</label>
                        <input class="form-control" id="adminMenuName" placeholder="ex.: Vagas">
                    </div>
                    <div class="col-12 col-md-6">
                        <label class="form-label small text-muted">Rota *</label>
                        <input class="form-control" id="adminMenuRoute" placeholder="/Vagas">
                    </div>
                    <div class="col-12 col-md-6">
                        <label class="form-label small text-muted">Icone</label>
                        <input class="form-control" id="adminMenuIcon" placeholder="bi-briefcase">
                    </div>
                    <div class="col-12 col-md-3">
                        <label class="form-label small text-muted">Ordem</label>
                        <input class="form-control" id="adminMenuOrder" type="number" min="0" value="0">
                    </div>
                    <div class="col-12 col-md-3">
                        <label class="form-label small text-muted">Status</label>
                        <select class="form-select" id="adminMenuStatus">
                            <option value="active">Ativo</option>
                            <option value="inactive">Inativo</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label class="form-label small text-muted">Permissao *</label>
                        <input class="form-control" id="adminMenuPermission" placeholder="vagas.view">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" type="button" data-bs-dismiss="modal">
                    <i class="bi bi-x-lg me-1"></i>Cancelar
                </button>
                <button class="btn btn-brand" type="button" id="btnAdminMenuSave">
                    <i class="bi bi-check2 me-1"></i>Salvar
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalAdminMenuDetails" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content" style="border-radius: 18px; border: 1px solid var(--lt-border);">
            <div class="modal-header">
                <div>
                    <h5 class="modal-title fw-bold">Detalhes do menu</h5>
                    <div class="text-muted small">Resumo e status do menu.</div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row g-2">
                    <div class="col-12 col-md-8">
                        <div class="fw-bold" data-role="detail-name"></div>
                        <div class="text-muted small mono" data-role="detail-id"></div>
                    </div>
                    <div class="col-12 col-md-4 text-md-end">
                        <span data-role="detail-status"></span>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="small text-muted">Rota</div>
                        <div class="fw-semibold mono" data-role="detail-route"></div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="small text-muted">Permissao</div>
                        <div class="fw-semibold mono" data-role="detail-permission"></div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="small text-muted">Icone</div>
                        <div class="fw-semibold" data-role="detail-icon"></div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="small text-muted">Ordem</div>
                        <div class="fw-semibold" data-role="detail-order"></div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="small text-muted">Pai</div>
                        <div class="fw-semibold" data-role="detail-parent"></div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="small text-muted">Criado em</div>
                        <div class="fw-semibold" data-role="detail-created"></div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="small text-muted">Atualizado em</div>
                        <div class="fw-semibold" data-role="detail-updated"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" type="button" data-bs-dismiss="modal">
                    <i class="bi bi-x-lg me-1"></i>Fechar
                </button>
            </div>
        </div>
    </div>
</div>

@section Footer {
    @{
        var footerItems = new[]
        {
            new { Icon = "bi-list", Text = "Menus", Id = "", Class = "" },
            new { Icon = "bi-shield-check", Text = "LGPD", Id = "", Class = "" },
            new { Icon = "", Text = "build: api", Id = "buildId", Class = "mono muted" }
        };
    }
    @await Html.PartialAsync("_Footer", footerItems)
}

@section Scripts {
    <script>
        window.__adminMenusData = @Html.Raw(JsonSerializer.Serialize(Model.Menus, jsonOptions));
    </script>
    <script src="~/js/views/admin-menus.js" asp-append-version="true"></script>
}
